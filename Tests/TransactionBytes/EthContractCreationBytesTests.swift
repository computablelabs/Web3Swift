//
// This source file is part of the Web3Swift.io open source project
// Copyright 2018 The Web3Swift Authors
// Licensed under Apache License v2.0
//
// EthContractCreationBytesTests.swift
//
// Created by Timofey Solonin on 10/05/2018
//

import CryptoSwift
import Nimble
import Quick
@testable import Web3Swift

final class EthContractCreationBytesTests: XCTestCase {

    func testSampleContractReplicatesCorrectly() {
        expect{
            try EthContractCreationBytes(
                networkID: SimpleInteger(
                    integer: 42
                ),
                transactionsCount: EthNumber(
                    hex: "0x00"
                ),
                gasPrice: EthNumber(
                    hex: "0x04A817C800"
                ),
                gasEstimate: EthNumber(
                    hex: "0x0F4240"
                ),
                senderKey: Alice().privateKey(),
                weiAmount: EthNumber(
                    hex: "0x00"
                ),
                contractCall: EncodedContract(
                    byteCode: BytesFromHexString(
                        hex: "608060405234801561001057600080fd5b5060405161054d38038061054d8339810180604052810190808051820192919060200180519060200190929190805190602001909291908051820192919060200191905050846000908051906020019061006b9291906100c0565b5083600160006101000a81548160ff0219169083151502179055508260028190555081600390805190602001906100a3929190610113565b508060049060026100b5929190610193565b505050505050610223565b828054828255906000526020600020908101928215610102579160200282015b828111156101015782518290600019169055916020019190600101906100e0565b5b50905061010f91906101d9565b5090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061015457805160ff1916838001178555610182565b82800160010185558215610182579182015b82811115610181578251825591602001919060010190610166565b5b50905061018f91906101fe565b5090565b82600281019282156101c8579160200282015b828111156101c75782518290600019169055916020019190600101906101a6565b5b5090506101d591906101d9565b5090565b6101fb91905b808211156101f75760008160009055506001016101df565b5090565b90565b61022091905b8082111561021c576000816000905550600101610204565b5090565b90565b61031b806102326000396000f300608060405260043610610041576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806373d4a13a14610046575b600080fd5b34801561005257600080fd5b5061005b61015f565b6040518080602001861515151581526020018581526020018060200184600260200280838360005b8381101561009e578082015181840152602081019050610083565b50505050905001838103835288818151815260200191508051906020019060200280838360005b838110156100e05780820151818401526020810190506100c5565b50505050905001838103825285818151815260200191508051906020019080838360005b8381101561011f578082015181840152602081019050610104565b50505050905090810190601f16801561014c5780820380516001836020036101000a031916815260200191505b5097505050505050505060405180910390f35b6060600080606061016e6102cd565b6000600160009054906101000a900460ff1660025460036004848054806020026020016040519081016040528092919081815260200182805480156101d657602002820191906000526020600020905b815460001916815260200190600101908083116101be575b50505050509450818054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156102725780601f1061024757610100808354040283529160200191610272565b820191906000526020600020905b81548152906001019060200180831161025557829003601f168201915b50505050509150806002806020026040519081016040528092919082600280156102b5576020028201915b8154600019168152602001906001019080831161029d575b50505050509050945094509450945094509091929394565b60408051908101604052806002906020820280388339808201915050905050905600a165627a7a72305820863d2af0195c42cc435073eae0f4231959493205d7b6ade14fe0e337edce6a0e0029"
                    ),
                    arguments: [
                        ABIDynamicCollection(
                            parameters: [
                                ABIFixedBytes(
                                    origin: BytesFromHexString(
                                        hex: "12"
                                    )
                                ),
                                ABIFixedBytes(
                                    origin: BytesFromHexString(
                                        hex: "3456"
                                    )
                                )
                            ]
                        ),
                        ABIBoolean(
                            origin: true
                        ),
                        ABIUnsignedNumber(
                            origin: EthNumber(
                                hex: "0x04A817C800"
                            )
                        ),
                        ABIVariableBytes(
                            origin: BytesFromHexString(
                                hex: "4d0000000000000000000000000000000000000000000000000000000000001211"
                            )
                        ),
                        ABIFixedBytes(
                            origin: BytesFromHexString(
                                hex: "78"
                            )
                        ),
                        ABIFixedBytes(
                            origin: BytesFromHexString(
                                hex: "123456"
                            )
                        )
                    ]
                )
            ).value().toHexString()
        }.to(
            equal(
                "f90720808504a817c800830f42408080b906cd608060405234801561001057600080fd5b5060405161054d38038061054d8339810180604052810190808051820192919060200180519060200190929190805190602001909291908051820192919060200191905050846000908051906020019061006b9291906100c0565b5083600160006101000a81548160ff0219169083151502179055508260028190555081600390805190602001906100a3929190610113565b508060049060026100b5929190610193565b505050505050610223565b828054828255906000526020600020908101928215610102579160200282015b828111156101015782518290600019169055916020019190600101906100e0565b5b50905061010f91906101d9565b5090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061015457805160ff1916838001178555610182565b82800160010185558215610182579182015b82811115610181578251825591602001919060010190610166565b5b50905061018f91906101fe565b5090565b82600281019282156101c8579160200282015b828111156101c75782518290600019169055916020019190600101906101a6565b5b5090506101d591906101d9565b5090565b6101fb91905b808211156101f75760008160009055506001016101df565b5090565b90565b61022091905b8082111561021c576000816000905550600101610204565b5090565b90565b61031b806102326000396000f300608060405260043610610041576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806373d4a13a14610046575b600080fd5b34801561005257600080fd5b5061005b61015f565b6040518080602001861515151581526020018581526020018060200184600260200280838360005b8381101561009e578082015181840152602081019050610083565b50505050905001838103835288818151815260200191508051906020019060200280838360005b838110156100e05780820151818401526020810190506100c5565b50505050905001838103825285818151815260200191508051906020019080838360005b8381101561011f578082015181840152602081019050610104565b50505050905090810190601f16801561014c5780820380516001836020036101000a031916815260200191505b5097505050505050505060405180910390f35b6060600080606061016e6102cd565b6000600160009054906101000a900460ff1660025460036004848054806020026020016040519081016040528092919081815260200182805480156101d657602002820191906000526020600020905b815460001916815260200190600101908083116101be575b50505050509450818054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156102725780601f1061024757610100808354040283529160200191610272565b820191906000526020600020905b81548152906001019060200180831161025557829003601f168201915b50505050509150806002806020026040519081016040528092919082600280156102b5576020028201915b8154600019168152602001906001019080831161029d575b50505050509050945094509450945094509091929394565b60408051908101604052806002906020820280388339808201915050905050905600a165627a7a72305820863d2af0195c42cc435073eae0f4231959493205d7b6ade14fe0e337edce6a0e002900000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000004a817c80000000000000000000000000000000000000000000000000000000000000001207800000000000000000000000000000000000000000000000000000000000000123456000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000021200000000000000000000000000000000000000000000000000000000000000345600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000214d00000000000000000000000000000000000000000000000000000000000012110000000000000000000000000000000000000000000000000000000000000078a03d4d3f3fc429e0f74c3e962682d079f0a5312ac6bf9ad658662dde271ec369daa031e9a47cff4d9afbd257e7f0528f5e86c46ddb362f54ca54cccd22e0a642bcbb"
            ),
            description: "This contract creation transaction from kovan is expected to be replicated correctly."
        )
    }

}
